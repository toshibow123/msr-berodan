# 本番環境デプロイ後の確認チェックリスト

## ⚠️ 本番環境で変わる可能性がある点

### 1. DMM広告ウィジェットの表示

**開発環境と本番環境で異なる可能性がある点：**

- **サードパーティCookieの制限**
  - 本番環境（HTTPS）では、サードパーティCookieの制限がより厳しくなる可能性があります
  - コンソールに「分離された Cookie」の警告が出ても、広告は表示される場合があります
  - ただし、広告が表示されない場合は、ブラウザのCookie設定を確認してください

- **スクリプトの読み込みタイミング**
  - 本番環境では、ビルド最適化によりスクリプトの読み込み順序が変わる可能性があります
  - 広告の初期化タイミングを調整する必要がある場合があります

**確認方法：**
```bash
# 本番環境で以下を確認
1. ブラウザの開発者ツール（F12）を開く
2. コンソールタブでエラーを確認
3. ネットワークタブで広告スクリプトが読み込まれているか確認
4. 各広告位置（位置2, 3, 4, 5）が表示されているか確認
```

### 2. 環境変数の設定

**必須の環境変数：**
```
NEXT_PUBLIC_SITE_URL=https://your-domain.com
```

⚠️ **重要**: `NEXT_PUBLIC_SITE_URL`が正しく設定されていないと：
- OGP画像が正しく生成されない
- sitemap.xmlのURLが間違う
- 構造化データ（JSON-LD）のURLが間違う

**確認方法：**
- Vercelの環境変数設定画面で確認
- 本番環境のURLが正しく設定されているか確認

### 3. 画像の読み込み

**DMM画像の読み込み：**
- `next.config.js`で`pics.dmm.co.jp`のリモートパターンを設定済み
- 本番環境でも問題なく表示されるはずです

**ローカル画像：**
- `public/images/`内の画像は問題なく表示されます
- ただし、画像ファイルが大きい場合は読み込みが遅くなる可能性があります

### 4. パフォーマンス

**本番環境での最適化：**
- Next.jsのビルド最適化により、初回読み込みが高速化されます
- 静的生成（SSG）により、記事ページは事前に生成されます

**注意点：**
- 新しい記事を追加した場合は、再ビルドが必要です
- Vercelでは、GitHubにプッシュすると自動的に再ビルドされます

### 5. SEO設定

**確認すべき項目：**
- [ ] `robots.txt`がアクセス可能（`/robots.txt`）
- [ ] `sitemap.xml`がアクセス可能（`/sitemap.xml`）
- [ ] OGP画像が正しく生成される（SNSでシェアして確認）
- [ ] 構造化データ（JSON-LD）が正しく設定されている

**確認ツール：**
- [Google Search Console](https://search.google.com/search-console)
- [Facebook Sharing Debugger](https://developers.facebook.com/tools/debug/)
- [Twitter Card Validator](https://cards-dev.twitter.com/validator)

### 6. アフィリエイトリンク

**確認すべき項目：**
- [ ] すべてのアフィリエイトリンクが正しく動作する
- [ ] アフィリエイトID（`toshichan-002`など）が正しく設定されている
- [ ] リンクが新しいタブで開く（`target="_blank"`）

### 7. レスポンシブデザイン

**確認すべき項目：**
- [ ] スマホ表示でレイアウトが崩れていない
- [ ] タブレット表示でレイアウトが崩れていない
- [ ] スティッキーフッター（モバイル）が正しく表示される

## 🔍 本番環境でのデバッグ方法

### 1. ブラウザの開発者ツール

```javascript
// コンソールで実行して、広告の状態を確認
console.log('DMM object:', window.DMM)
console.log('Widget:', window.DMM?.widget)

// 広告コンテナを確認
document.querySelectorAll('ins.dmm-widget-placement').forEach((ins, i) => {
  console.log(`広告${i + 1}:`, ins.getAttribute('data-id'), ins.innerHTML)
})
```

### 2. ネットワークタブ

- `widget-view.dmm.co.jp`のリクエストが成功しているか確認
- 広告画像の読み込みが成功しているか確認

### 3. エラーログ

- Vercelのデプロイログでエラーがないか確認
- ブラウザのコンソールでエラーがないか確認

## 📝 デプロイ後の確認手順

1. **基本動作確認**
   - [ ] トップページが表示される
   - [ ] 記事詳細ページが表示される
   - [ ] 画像が正しく表示される

2. **広告表示確認**
   - [ ] 位置1: FANZA TVリンクが表示される
   - [ ] 位置2: 広告が表示される（本文の前）
   - [ ] 位置3: 広告が表示される（本文内）
   - [ ] 位置4: 広告が表示される（本文の後）
   - [ ] 位置5: サイドバー広告が表示される

3. **機能確認**
   - [ ] タグフィルターが動作する
   - [ ] 年代フィルターが動作する
   - [ ] アフィリエイトリンクが動作する

4. **SEO確認**
   - [ ] `robots.txt`がアクセス可能
   - [ ] `sitemap.xml`がアクセス可能
   - [ ] OGP画像が正しく生成される

## 🚨 よくある問題と対処法

### 問題1: 広告が表示されない

**原因：**
- サードパーティCookieがブロックされている
- 広告IDが無効
- スクリプトの読み込みタイミングの問題

**対処法：**
1. ブラウザのCookie設定を確認
2. 広告IDがDMMの管理画面で有効か確認
3. コンソールでエラーメッセージを確認
4. ページを再読み込み

### 問題2: 画像が表示されない

**原因：**
- `next.config.js`のリモートパターン設定が間違っている
- 画像URLが間違っている

**対処法：**
1. `next.config.js`の設定を確認
2. 画像URLが正しいか確認
3. ネットワークタブで画像の読み込みエラーを確認

### 問題3: OGP画像が表示されない

**原因：**
- `NEXT_PUBLIC_SITE_URL`が正しく設定されていない
- OGP画像ファイルが存在しない

**対処法：**
1. 環境変数`NEXT_PUBLIC_SITE_URL`を確認
2. `public/og-image.jpg`が存在するか確認
3. Facebook Sharing Debuggerで確認

## 📞 サポート

問題が発生した場合は、以下を確認してください：
1. ブラウザのコンソールエラー
2. Vercelのデプロイログ
3. ネットワークタブのリクエスト/レスポンス

