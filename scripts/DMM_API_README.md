# DMM API スクレイパー

DMM (FANZA) APIを使用してアダルト動画データを取得するPythonスクリプトです。

## 🎯 機能

- **キーワード検索**: 熟女、人妻、NTR等の指定キーワードで作品を検索
- **除外フィルター**: ベスト・総集編などの不要な作品を自動除外
- **女優名検証**: 女優名が存在する作品のみを対象
- **重複除去**: 同一作品の重複取得を防止
- **レート制限対応**: API制限に配慮した適切な待機時間
- **統計情報**: 収集結果の詳細な分析とサマリー表示

## 📋 検索対象キーワード

以下のキーワードを含む作品を検索します：
- お母さん
- 女将・女主人
- 義母
- 熟女
- 寝取り・寝取られ・NTR
- 人妻・主婦
- 未亡人
- ママ友
- 若妻・幼妻
- 妊婦
- ドラマ

## 🚫 除外条件

以下のジャンルを含む作品は自動的に除外されます：
- ベスト・総集編
- ベスト
- 総集編

## 🛠️ セットアップ

### 1. 依存関係のインストール

```bash
cd scripts
pip install -r requirements.txt
```

### 2. 環境変数の設定

1. `env_sample.txt` を `.env` にコピー：
```bash
cp env_sample.txt .env
```

2. `.env` ファイルを編集してAPI情報を設定：
```bash
# DMM API 設定
DMM_API_ID=your_actual_api_id
DMM_AFFILIATE_ID=your_actual_affiliate_id
```

### 3. DMM API アカウントの取得

1. [DMM アフィリエイト](https://affiliate.dmm.com/) でアカウントを作成
2. API IDとアフィリエイトIDを取得
3. `.env` ファイルに設定

## 🚀 実行方法

```bash
python dmm_api_scraper.py
```

## 📊 出力データ

### JSONファイル (`actress_videos.json`)

```json
{
  "total_count": 1500,
  "collected_at": "2024-01-15T10:30:00",
  "keywords_used": ["熟女", "人妻・主婦", ...],
  "excluded_keywords": ["ベスト・総集編", ...],
  "unique_actresses": 450,
  "videos": [
    {
      "content_id": "abc123",
      "title": "作品タイトル",
      "actress": "女優名1, 女優名2",
      "actresses": ["女優名1", "女優名2"],
      "genres": ["熟女", "ドラマ"],
      "package_image": "https://...",
      "sample_images": ["https://...", ...],
      "affiliate_url": "https://...",
      "date": "2024-01-01",
      "collected_at": "2024-01-15T10:30:00"
    }
  ]
}
```

### コンソール出力

```
🎬 DMM API アダルト動画データ収集スクリプト
============================================================

🚀 DMM API スクレイパー初期化完了
📋 検索キーワード: お母さん, 女将・女主人, 義母, 熟女, ...
🚫 除外キーワード: ベスト・総集編, ベスト, 総集編

🎯 キーワード '熟女' の検索開始
🔍 検索中: '熟女' (offset: 1)
✅ 取得成功: 100件 (総件数: 15000件)
📊 '熟女': 85件の有効なアイテムを追加 (累計: 85件)

...

🎉 全検索完了! 総取得件数: 1500件

📋 収集サマリー
==================================================

👑 作品数上位女優 (TOP 10):
    1. 篠田ゆう: 25作品
    2. 川上ゆう（森野雫）: 22作品
    ...

🏷️  人気ジャンル (TOP 10):
    1. 熟女: 450作品
    2. 人妻・主婦: 380作品
    ...

💾 データ保存完了: actress_videos.json
📊 統計:
   - 総作品数: 1500件
   - ユニーク女優数: 450人

✅ 処理完了!
```

## ⚙️ カスタマイズ

### 検索キーワードの変更

`dmm_api_scraper.py` の `include_keywords` リストを編集：

```python
self.include_keywords = [
    'あなたの検索キーワード1',
    'あなたの検索キーワード2',
    # ...
]
```

### 取得件数の調整

`main()` 関数の `max_per_keyword` パラメータを変更：

```python
videos = scraper.collect_all_videos(max_per_keyword=500)  # キーワードあたり500件まで
```

### 除外条件の追加

`exclude_keywords` リストに追加：

```python
self.exclude_keywords = [
    'ベスト・総集編', 'ベスト', '総集編',
    'あなたの除外キーワード'
]
```

## 📝 注意事項

1. **API制限**: DMM APIには1日あたりのリクエスト制限があります
2. **利用規約**: DMM APIの利用規約を必ず遵守してください
3. **レート制限**: スクリプトは1秒間隔でリクエストを送信します
4. **データ量**: 大量のデータを取得する場合は時間がかかります
5. **エラーハンドリング**: ネットワークエラー等で中断した場合は再実行してください

## 🔧 トラブルシューティング

### よくあるエラー

1. **API認証エラー**
   ```
   ValueError: DMM_API_ID と DMM_AFFILIATE_ID を .env ファイルに設定してください
   ```
   → `.env` ファイルの設定を確認

2. **ネットワークエラー**
   ```
   ❌ API リクエストエラー: ...
   ```
   → インターネット接続とAPI制限を確認

3. **JSON デコードエラー**
   ```
   ❌ JSON デコードエラー: ...
   ```
   → APIレスポンスの形式を確認

### デバッグモード

詳細なログを確認したい場合は、スクリプト内の `print` 文を参考にしてください。

## 📄 ライセンス

このスクリプトは教育・研究目的で作成されています。商用利用の場合は、DMM APIの利用規約を確認してください。
