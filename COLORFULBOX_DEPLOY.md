# カラフルボックスへのデプロイ手順

## 📋 現在のサイトの状態

このサイトは**静的サイト（SSG: Static Site Generation）**です。

- ✅ 記事ページは`generateStaticParams`で事前に生成される
- ✅ トップページも静的生成される
- ✅ すべてのページがビルド時に生成される

## 🚀 カラフルボックスへのデプロイ方法

カラフルボックスは通常、Node.jsの実行環境がないレンタルサーバーです。そのため、**静的サイトとしてエクスポート**する必要があります。

### Step 1: 静的エクスポートの設定

`next.config.js`に`output: 'export'`を追加します：

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export', // 静的サイトとしてエクスポート
  images: {
    unoptimized: true, // 静的エクスポート時は画像最適化を無効化
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'pics.dmm.co.jp',
        pathname: '/**',
      },
    ],
  },
  // 本番環境の最適化設定
  compress: true,
  poweredByHeader: false,
  reactStrictMode: true,
  turbopack: {},
}

module.exports = nextConfig
```

### Step 2: ビルドとエクスポート

```bash
# 静的サイトとしてビルド
npm run build
```

ビルドが成功すると、`out`ディレクトリに静的ファイルが生成されます。

### Step 3: FTPでアップロード

1. **FTPクライアントを準備**
   - FileZilla、Cyberduck、WinSCPなど

2. **カラフルボックスのFTP情報を取得**
   - ホスト名（例: `ftp.example.com`）
   - ユーザー名
   - パスワード
   - ポート番号（通常は21）

3. **`out`ディレクトリの内容をアップロード**
   - `out`ディレクトリ内の**すべてのファイルとフォルダ**を選択
   - カラフルボックスの**公開ディレクトリ**（通常は`public_html`または`www`）にアップロード

4. **ファイルの権限設定**
   - ファイル: `644`
   - ディレクトリ: `755`

### Step 4: 確認

1. ブラウザでサイトにアクセス
2. すべてのページが正しく表示されるか確認
3. 画像が正しく表示されるか確認
4. アフィリエイトリンクが動作するか確認

## ⚠️ 注意事項

### 静的エクスポートの制限

1. **画像の最適化**
   - `next/image`の最適化機能は使えません
   - 通常の`<img>`タグを使用します（既に対応済み）

2. **動的な機能**
   - API Routesは使えません（このサイトでは使用していないので問題なし）
   - サーバーサイドの処理は実行されません

3. **新しい記事の追加**
   - 新しい記事を追加した場合は、ローカルで再ビルドして、`out`ディレクトリを再アップロードする必要があります

### 推奨される運用方法

1. **ローカルで記事を追加**
   ```bash
   # 記事生成スクリプトを実行
   python3 scripts/write_heisei_review.py
   ```

2. **ビルド**
   ```bash
   npm run build
   ```

3. **FTPでアップロード**
   - `out`ディレクトリの内容をアップロード

## 🔄 自動デプロイ（オプション）

カラフルボックスでは自動デプロイが難しいため、手動でのアップロードが必要です。

ただし、GitHub Actionsなどを使用して、自動的にビルドしてFTPでアップロードするスクリプトを作成することも可能です。

## 📝 チェックリスト

デプロイ前：
- [ ] `next.config.js`に`output: 'export'`を追加
- [ ] `images.unoptimized: true`を設定
- [ ] ローカルで`npm run build`が成功することを確認
- [ ] `out`ディレクトリが生成されることを確認

デプロイ後：
- [ ] トップページが表示される
- [ ] 記事詳細ページが表示される
- [ ] 画像が正しく表示される
- [ ] アフィリエイトリンクが動作する
- [ ] タグフィルターが動作する（クライアントサイドなので動作するはず）

